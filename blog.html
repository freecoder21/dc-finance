<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - DCM Financing</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;500;700&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Blog Post Styles */
        .blog-post {
            position: relative;
            overflow: hidden;
        }
        
        .post-content {
            position: relative;
        }
        
        .post-excerpt {
            position: relative;
            margin-bottom: 20px;
        }
        
        .post-excerpt p {
            color: #555555 !important;
            line-height: 1.6;
            margin-bottom: 0;
        }
        
        .read-more {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--secondary-color);
            font-weight: 600;
            transition: var(--transition);
            margin-top: auto;
        }
        
        .read-more:hover {
            color: var(--primary-color);
            gap: 12px;
        }
        
        /* Featured Post Styles */
        .featured-post {
            position: relative;
            margin-bottom: 60px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            background-color: var(--white);
        }
        
        .featured-post .read-more {
            padding: 12px 25px;
            background-color: var(--secondary-color);
            color: var(--white);
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .featured-post .read-more:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            color: var(--white);
            gap: 12px;
        }
        .no-posts {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 1.1rem;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <a href="index.html">
                        <img src="assets/dcm_logo.png" alt="DCM Financing">
                    </a>
                </div>
                <nav class="main-nav">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="news-updates.html">News & Updates</a></li>
                        <li><a href="blog.html" class="active">Blog</a></li>
                        <li><a href="#contact" class="btn-primary">Get in Touch</a></li>
                    </ul>
                </nav>
                <div class="mobile-menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 id="page-title">Loading...</h1>
            <p id="page-description">Loading...</p>
        </div>
    </section>

    <!-- Blog Content -->
    <section class="blog-page">
        <div class="container">
            <div class="blog-content">
                <!-- Main Blog Posts -->
                <div class="blog-main">
                    <!-- Featured Post -->
                    <div class="featured-post" id="featured-post">
                        <div class="featured-image">
                            <img id="featured-image" src="" alt="">
                        </div>
                        <div class="featured-content">
                            <span class="post-category" id="featured-category"></span>
                            <h2 id="featured-title"></h2>
                            <p class="post-meta" id="featured-meta"></p>
                            <div class="post-excerpt" id="featured-excerpt"></div>
                            <a href="#" class="read-more" id="featured-read-more">
                                Read Full Article <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Blog Posts Grid -->
                    <div class="blog-grid" id="blog-grid">
                        <!-- Posts will be dynamically inserted here -->
                    </div>

                    <!-- Pagination -->
                    <div class="pagination">
                        <a href="#" class="page-btn active">1</a>
                        <a href="#" class="page-btn">2</a>
                        <a href="#" class="page-btn">3</a>
                        <a href="#" class="page-btn next">Next <i class="fas fa-chevron-right"></i></a>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside class="blog-sidebar">
                    <!-- Search -->
                    <div class="sidebar-widget">
                        <h3>Search Blog</h3>
                        <div class="search-form">
                            <input type="text" placeholder="Search articles..." id="search-input">
                            <button type="submit"><i class="fas fa-search"></i></button>
                        </div>
                    </div>

                    <!-- Categories -->
                    <div class="sidebar-widget">
                        <h3>Categories</h3>
                        <ul class="categories-list" id="categories-list">
                            <!-- Categories will be dynamically inserted here -->
                        </ul>
                    </div>

                    <!-- Popular Posts -->
                    <div class="sidebar-widget">
                        <h3>Popular Posts</h3>
                        <div class="popular-posts" id="popular-posts">
                            <!-- Popular posts will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- Newsletter -->
                    <div class="sidebar-widget newsletter-widget">
                        <h3 id="newsletter-title">Stay Informed</h3>
                        <p id="newsletter-description">Get the latest commercial lending insights for seasoned investors delivered to your inbox.</p>
                        <form class="sidebar-newsletter">
                            <input type="email" placeholder="Your email address" required>
                            <button type="submit" class="btn-primary">Subscribe</button>
                        </form>
                    </div>

                    <!-- Tags -->
                    <div class="sidebar-widget">
                        <h3>Popular Tags</h3>
                        <div class="tags" id="popular-tags">
                            <!-- Tags will be dynamically inserted here -->
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
        <div class="container">
            <div class="newsletter-content">
                <h2 id="newsletter-section-title">Never Miss an Update</h2>
                <p id="newsletter-section-description">Subscribe to our newsletter for expert commercial lending insights and market analysis for seasoned investors.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your email address" required>
                    <button type="submit" class="btn-primary" id="newsletter-button">Subscribe Now</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="assets/dcm_logo.png" alt="DCM Financing">
                    </div>
                    <p id="footer-description">Providing innovative commercial financing solutions for seasoned investors and developers.</p>
                    <div class="social-links" id="social-links">
                        <!-- Social links will be dynamically inserted here -->
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul id="quick-links">
                        <!-- Quick links will be dynamically inserted here -->
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Services</h3>
                    <ul id="service-links">
                        <!-- Service links will be dynamically inserted here -->
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <ul class="contact-info">
                        <li><i class="fas fa-map-marker-alt"></i> <span id="footer-address">123 Financial District, NY 10005</span></li>
                        <li><i class="fas fa-phone-alt"></i> <span id="footer-phone">+1 (212) 555-7890</span></li>
                        <li><i class="fas fa-envelope"></i> <span id="footer-email">info@dcmfinancing.com</span></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p id="copyright">&copy; 2025 DCM Financing. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
 <script>
  document.addEventListener('DOMContentLoaded', function() {
    let allBlogPosts = [];
    let currentPage = 1;
    const postsPerPage = 2;
    let currentFilter = 'all'; // Track current filter

    // Debug logging
    console.log('Script loaded, waiting for JSON data...');

    // Fetch the JSON data
    fetch('/content/pages/blog.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Populate page header
            document.getElementById('page-title').textContent = data.page_header.title;
            document.getElementById('page-description').textContent = data.page_header.description;

            // Populate featured post
            const featuredPost = data.featured_post;
            document.getElementById('featured-image').src = featuredPost.image;
            document.getElementById('featured-image').alt = featuredPost.alt;
            document.getElementById('featured-category').textContent = featuredPost.category;
            document.getElementById('featured-title').textContent = featuredPost.title;
            document.getElementById('featured-meta').innerHTML = `By <strong>${featuredPost.author}</strong> | ${featuredPost.date} | ${featuredPost.reading_time}`;
            document.getElementById('featured-excerpt').innerHTML = `<p>${featuredPost.excerpt}</p>`;
            
            // ✅ FIXED: Set featured post read more link to use URL parameters
            const featuredReadMore = document.getElementById('featured-read-more');
            featuredReadMore.href = `blog-post.html?slug=${featuredPost.slug}`;

            // Store all blog posts and initialize
            allBlogPosts = data.blog_posts;
            
            // Debug logging
            console.log('Total blog posts loaded:', allBlogPosts.length);
            console.log('Categories found:', [...new Set(allBlogPosts.map(post => post.category))]);
            
            // Initialize categories FIRST
            initializeCategories();
            
            // Then display posts
            displayBlogPosts(currentPage, allBlogPosts);
            initializePagination(allBlogPosts);

            // Populate popular posts with actual blog posts (most recent first)
            const popularPosts = document.getElementById('popular-posts');
            // Get the 3 most recent blog posts for popular posts
            const recentPosts = [...allBlogPosts]
                .sort((a, b) => {
                    // Sort by date - most recent first
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    return dateB - dateA;
                })
                .slice(0, 3);

            recentPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'popular-post';
                postElement.innerHTML = `
                    <div class="popular-image">
                        <img src="${post.image}" alt="${post.alt || post.title}">
                    </div>
                    <div class="popular-content">
                        <!-- ✅ UPDATED: Popular posts links to use URL parameters -->
                        <h4><a href="blog-post.html?slug=${post.slug}">${post.title}</a></h4>
                        <span class="post-date">${post.date}</span>
                    </div>
                `;
                popularPosts.appendChild(postElement);
            });

            // Populate newsletter sidebar
            document.getElementById('newsletter-title').textContent = data.sidebar.newsletter.title;
            document.getElementById('newsletter-description').textContent = data.sidebar.newsletter.description;

            // Populate tags with actual tags from blog posts
            const tagsContainer = document.getElementById('popular-tags');
            // Extract unique tags from all blog posts
            const allTags = new Set();
            allBlogPosts.forEach(post => {
                if (post.tags && Array.isArray(post.tags)) {
                    post.tags.forEach(tag => allTags.add(tag));
                }
            });
            
            // Convert Set to array and take first 8 tags
            const uniqueTags = Array.from(allTags).slice(0, 8);
            uniqueTags.forEach(tag => {
                const tagElement = document.createElement('a');
                tagElement.href = '#'; // You can implement tag filtering here
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagElement.dataset.tag = tag.toLowerCase().replace(/\s+/g, '-');
                tagsContainer.appendChild(tagElement);
            });

            // Populate newsletter section
            document.getElementById('newsletter-section-title').textContent = data.newsletter_section.title;
            document.getElementById('newsletter-section-description').textContent = data.newsletter_section.description;
            document.getElementById('newsletter-button').textContent = data.newsletter_section.button_text;

            // Populate footer
            document.getElementById('footer-description').textContent = data.footer.description;
            document.getElementById('footer-address').textContent = data.footer.address;
            document.getElementById('footer-phone').textContent = data.footer.phone;
            document.getElementById('footer-email').textContent = data.footer.email;
            
            // Populate social links
            const socialLinks = document.getElementById('social-links');
            data.footer.social_links.forEach(link => {
                const linkElement = document.createElement('a');
                linkElement.href = link.url;
                linkElement.innerHTML = `<i class="${link.icon}"></i>`;
                socialLinks.appendChild(linkElement);
            });
            
            // Populate quick links
            const quickLinks = document.getElementById('quick-links');
            data.footer.quick_links.forEach(link => {
                const linkElement = document.createElement('li');
                linkElement.innerHTML = `<a href="${link.url}">${link.label}</a>`;
                quickLinks.appendChild(linkElement);
            });
            
            // Populate service links
            const serviceLinks = document.getElementById('service-links');
            data.footer.service_links.forEach(link => {
                const linkElement = document.createElement('li');
                linkElement.innerHTML = `<a href="${link.url}">${link.label}</a>`;
                serviceLinks.appendChild(linkElement);
            });
            
            document.getElementById('copyright').innerHTML = data.footer.copyright;
        })
        .catch(error => {
            console.error('Error fetching blog data:', error);
            document.getElementById('page-title').textContent = 'Error Loading Content';
            document.getElementById('page-description').textContent = 'Please try again later.';
        });

    // Function to initialize categories dynamically
    function initializeCategories() {
        const categoriesList = document.getElementById('categories-list');
        categoriesList.innerHTML = ''; // Clear any existing content

        // Extract unique categories and count posts in each
        const categoryCounts = {};
        allBlogPosts.forEach(post => {
            if (post.category) {
                categoryCounts[post.category] = (categoryCounts[post.category] || 0) + 1;
            }
        });

        // Create "All" category
        const allCategoryElement = document.createElement('li');
        allCategoryElement.innerHTML = `<a href="#" data-category="all" class="active">All <span>(${allBlogPosts.length})</span></a>`;
        categoriesList.appendChild(allCategoryElement);

        // Add event listener for "All" category
        allCategoryElement.addEventListener('click', function(e) {
            e.preventDefault();
            filterPostsByCategory('all');
        });

        // Create category elements for each unique category
        Object.keys(categoryCounts).forEach(category => {
            const categoryElement = document.createElement('li');
            const categorySlug = category.toLowerCase().replace(/\s+/g, '-');
            categoryElement.innerHTML = `<a href="#" data-category="${categorySlug}">${category} <span>(${categoryCounts[category]})</span></a>`;
            categoriesList.appendChild(categoryElement);

            // Add click event to filter by category
            categoryElement.addEventListener('click', function(e) {
                e.preventDefault();
                filterPostsByCategory(category);
            });
        });
    }

    // Function to filter posts by category
    function filterPostsByCategory(category) {
        console.log('Filtering by category:', category); // Debug log
        
        // Update active state in categories
        document.querySelectorAll('.categories-list a').forEach(link => {
            link.classList.remove('active');
        });
        
        // Activate the clicked category
        document.querySelectorAll('.categories-list a').forEach(link => {
            if (category === 'all' && link.dataset.category === 'all') {
                link.classList.add('active');
            } else if (link.dataset.category === category.toLowerCase().replace(/\s+/g, '-')) {
                link.classList.add('active');
            }
        });

        currentFilter = category;
        currentPage = 1;

        // Filter posts
        let postsToDisplay;
        if (category === 'all') {
            postsToDisplay = allBlogPosts;
        } else {
            postsToDisplay = allBlogPosts.filter(post => post.category === category);
        }

        console.log('Posts to display:', postsToDisplay.length); // Debug log
        displayBlogPosts(currentPage, postsToDisplay);
        initializePagination(postsToDisplay);
        
        // Scroll to blog grid section for better UX
        setTimeout(() => {
            const blogGrid = document.querySelector('.blog-grid');
            if (blogGrid) {
                const yOffset = -80; // Adjust this value to control how much to scroll down
                const y = blogGrid.getBoundingClientRect().top + window.pageYOffset + yOffset;
                
                window.scrollTo({
                    top: y,
                    behavior: 'smooth'
                });
            }
        }, 100); // Small delay to ensure content is rendered
    }

    // Function to display blog posts
    function displayBlogPosts(page, posts) {
        const blogGrid = document.getElementById('blog-grid');
        blogGrid.innerHTML = '';
        
        const startIndex = (page - 1) * postsPerPage;
        const endIndex = startIndex + postsPerPage;
        const postsToShow = posts.slice(startIndex, endIndex);
        
        if (postsToShow.length === 0) {
            blogGrid.innerHTML = '<p class="no-posts">No posts found in this category.</p>';
            return;
        }
        
        postsToShow.forEach(post => {
            const postElement = document.createElement('article');
            postElement.className = 'blog-post';
            postElement.innerHTML = `
                <div class="post-image">
                    <img src="${post.image}" alt="${post.alt}">
                </div>
                <div class="post-content">
                    <span class="post-category">${post.category}</span>
                    <h3>${post.title}</h3>
                    <p class="post-meta">By <strong>${post.author}</strong> | ${post.date} | ${post.reading_time}</p>
                    <div class="post-excerpt">
                        <p>${post.excerpt}</p>
                    </div>
                    <!-- ✅ UPDATED: Regular post links to use URL parameters -->
                    <a href="blog-post.html?slug=${post.slug}" class="read-more">
                        Read More <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            `;
            blogGrid.appendChild(postElement);
        });
    }

    // Function to initialize pagination
    function initializePagination(posts) {
        const totalPages = Math.ceil(posts.length / postsPerPage);
        const paginationContainer = document.querySelector('.pagination');
        
        // Clear existing pagination
        paginationContainer.innerHTML = '';
        
        // Only show pagination if there's more than one page
        if (totalPages <= 1) {
            paginationContainer.style.display = 'none';
            return;
        }
        
        paginationContainer.style.display = 'flex';
        
        // Previous button
        if (currentPage > 1) {
            const prevBtn = document.createElement('a');
            prevBtn.href = '#'; 
            prevBtn.className = 'page-btn prev';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i> Prev';
            prevBtn.addEventListener('click', function(e) {
                e.preventDefault();
                goToPage(currentPage - 1, posts);
            });
            paginationContainer.appendChild(prevBtn);
        }
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const pageBtn = document.createElement('a');
            pageBtn.href = '#';
            pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
            pageBtn.textContent = i;
            pageBtn.addEventListener('click', function(e) {
                e.preventDefault();
                goToPage(i, posts);
            });
            paginationContainer.appendChild(pageBtn);
        }
        
        // Next button
        if (currentPage < totalPages) {
            const nextBtn = document.createElement('a');
            nextBtn.href = '#';
            nextBtn.className = 'page-btn next';
            nextBtn.innerHTML = 'Next <i class="fas fa-chevron-right"></i>';
            nextBtn.addEventListener('click', function(e) {
                e.preventDefault();
                goToPage(currentPage + 1, posts);
            });
            paginationContainer.appendChild(nextBtn);
        }
    }

    // Function to navigate to a specific page
    function goToPage(page, posts) {
        currentPage = page;
        
        // Get the current filtered posts
        let postsToDisplay;
        if (currentFilter === 'all') {
            postsToDisplay = allBlogPosts;
        } else {
            postsToDisplay = allBlogPosts.filter(post => post.category === currentFilter);
        }
        
        displayBlogPosts(currentPage, postsToDisplay);
        initializePagination(postsToDisplay);
        
        // Scroll to blog grid section for better UX
        setTimeout(() => {
            const blogGrid = document.querySelector('.blog-grid');
            if (blogGrid) {
                const yOffset = -80; // Adjust this value to control how much to scroll down
                const y = blogGrid.getBoundingClientRect().top + window.pageYOffset + yOffset;
                
                window.scrollTo({
                    top: y,
                    behavior: 'smooth'
                });
            }
        }, 100);
    }

    // Blog search functionality
    const searchForm = document.querySelector('.search-form');
    const searchInput = document.getElementById('search-input');
    
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const searchTerm = searchInput.value.trim();
        if (searchTerm) {
            alert(`Searching for: ${searchTerm}`);
            // In production, this would redirect to search results
        }
    });

    // Tag filtering
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('tag')) {
            e.preventDefault();
            const tagName = e.target.textContent;
            alert(`Filtering by tag: ${tagName}`);
            // In production, this would filter blog posts
        }
    });
});

 </script>
</body>
</html>